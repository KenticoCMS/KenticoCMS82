var CMSPlugin={window:this.window,requires:["iframedialog","fakeobjects"],currentEditor:null,lang:["en"],regNumber:/^\d+(?:\.\d+)?$/,regFlashFilename:/\.swf(?:$|\?)/i,selection:null,selectedElement:null,selectionBookmarks:null,cssifyLength:function(t){if(CMSPlugin.regNumber.test(t)){return t+"px"}return t},createFakeControl:function(e,t){if(e!==null){var n=null,r=e.attributes.type.toLowerCase(),i;switch(r){case"youtubevideo":n=t.createFakeParserElement(e,"cke_youtube","object",true);n.attributes.cms_youtube="true";n.attributes.cms_disable_media="true";break;case"flash":case"media":var s=this.getMediaType(e,t);if(s==="flash"||r==="flash"){n=t.createFakeParserElement(e,"cke_flash","object",true);n.attributes.cms_media="true"}else{n=t.createFakeParserElement(e,"cke_media","object",true);n.attributes.cms_media="true"}break;case"mediafilecontrol":n=t.createFakeParserElement(e,"cke_old_media","object",true);n.attributes.cms_media="true";break;case"image":if(!(e.attributes.width&&parseInt(e.attributes.width,10)>0&&e.attributes.height&&parseInt(e.attributes.height,10)>0)){i=this.getElementObject(e);if(i){if((!e.attributes.width||parseInt(e.attributes.width,10)<=0)&&(!e.attributes.height||parseInt(e.attributes.height,10)<=0)){e.attributes.width=i.originalwidth;e.attributes.height=i.originalheight}else if(!e.attributes.height||parseInt(e.attributes.height,10)<=0){e.attributes.height=Math.round(e.attributes.width/(parseFloat(i.originalwidth)/i.originalheight))}else if(!e.attributes.width||parseInt(e.attributes.width,10)<=0){e.attributes.width=Math.round(e.attributes.height/(parseFloat(i.originalheight)/i.originalwidth))}}}n=t.createFakeParserElement(e,"cke_image","object",true);n.attributes.cms_media="true";var o=this.getImageUrl(e,t);if(o){n.attributes.src=o}break;case"widget":i=this.getElementObject(e);n=t.createFakeParserElement(e,"cke_widget","object",true);n.attributes.cms_disable_media="true";n.attributes.cke_widget="true";if(i.image_guid){u=n.attributes.style||"";n.attributes.style=u+"background-image:url("+t.config.ApplicationPath+"CMSPages/GetMetaFile.aspx?fileguid="+i.image_guid+"&maxsidesize=32);"}if(i.widget_displayname){n.attributes.title=i.widget_displayname.replace(/\+/g," ")}break;default:n=t.createFakeParserElement(e,"cke_inlinecontrol","object",false);n.attributes.cms_disable_media="true";break}n.attributes.cms_inline="true";n.attributes.alt="";var u=n.attributes.style||"",a=e.attributes.width,f=e.attributes.height;if(r.toLowerCase()!="widget"){n.attributes.title="";if(typeof a!="undefined"){u=n.attributes.style=u+"width:"+this.cssifyLength(a)+";"}if(typeof f!="undefined"){u=n.attributes.style=u+"height:"+this.cssifyLength(f)+";"}}return n}else{return null}},getNodeList:function(e){return new CKEDITOR.dom.nodeList(e)},getElementObject:function(e){var t={},n,r;if(e){var i;if(e._){for(i=0;i<e.children.length;i++){n=e.children[i].attributes.name;r=e.children[i].attributes.value;t[n]=r}}else{for(i=0;i<e.children.length;i++){n=e.children[i].getAttribute("name");r=e.children[i].getAttribute("value");t[n]=r}}}return t},getCurrentEditor:function(){if(this.currentEditor!==null){return this.currentEditor}else{if(CKEDITOR.currentInstance!==null){return CKEDITOR.currentInstance}}return null},getImageUrl:function(e,t){t=t||this.getCurrentEditor();var n=null,r=CMSPlugin.getElementObject(e);if(r.url){n=r.url;if(n.indexOf("~/")===0){n=n.replace("~/",t.config.ApplicationPath)}}return n},getMediaType:function(e){var t=this.getElementObject(e);if(t.cms_type){return t.cms_type.toLowerCase()}if(t.ext&&t.ext.toLowerCase()===".swf"||CMSPlugin.isFlashEmbed(e)){return"flash"}return"audiovideo"},isFlashEmbed:function(e){var t=e.attributes;return t.type=="application/x-shockwave-flash"||t.type=="flash"||CMSPlugin.regFlashFilename.test(t.src||"")},initCss:function(e){var t="background-position: center center;"+"background-repeat: no-repeat;"+"border: 1px solid #CCC;"+"width: 80px;"+"height: 80px;";CKEDITOR.addCss("img.cke_inlinecontrol { background-image: url("+CKEDITOR.getUrl(e.config.CMSPluginUrl+"images/CMSInline_bg.png")+");"+t+"}");CKEDITOR.addCss("img.cke_youtube { background-image: url("+CKEDITOR.getUrl(e.config.CMSPluginUrl+"images/InsertYouTube_bg.png")+");"+t+"}");CKEDITOR.addCss("img.cke_media { background-image: url("+CKEDITOR.getUrl(e.config.CMSPluginUrl+"images/InsertImageOrMedia_bg.png")+");"+t+"}");CKEDITOR.addCss("img.cke_flash { background-image: url("+CKEDITOR.getUrl(e.config.CMSPluginUrl+"images/InsertFlash_bg.png")+");"+t+"}");CKEDITOR.addCss("img.cke_widget { background-image: url("+CKEDITOR.getUrl(e.config.CMSPluginUrl+"images/InsertWidget_bg.png")+");"+t+"width: 32px;"+"height: 32px;"+"}");CKEDITOR.addCss("img.cke_old_media { background-image: url("+CKEDITOR.getUrl(e.config.CMSPluginUrl+"images/InsertImageOrMediaOld_bg.png")+");"+t+"}")},openWidget:function(e,t,n,r,i){this.currentEditor=e;var s,o=e.getSelection().getSelectedElement();if(e.config.IsLiveSite){s=e.config.ApplicationPath+"CMSModules/Widgets/LiveDialogs/"+t}else{s=e.config.ApplicationPath+"CMSModules/Widgets/Dialogs/"+t}if(o&&o.hasAttribute("cms_inline")){var u=e.restoreRealElement(o),a=this.getInline(u.$);if(a.cms_type==="widget"&&(n===null||n===a.name)){if(e.config.IsLiveSite){s=e.config.ApplicationPath+"CMSModules/Widgets/LiveDialogs/WidgetProperties.aspx?inline=true"}else{s=e.config.ApplicationPath+"CMSModules/Widgets/Dialogs/WidgetProperties.aspx?inline=true"}r=900;i=650}}if(e.config.CurrentGroupID){s+="&groupid="+e.config.CurrentGroupID}CMSPlugin.openModalDialog(s,n,r,i)},pluginInsertForms:function(e){var t="InsertForms",n={exec:function(e){CMSPlugin.openWidget(e,"WidgetProperties.aspx?inline=true&isnew=1&widgetname=BizForm","BizForm","900","600")}},r={label:e.lang.CMSPlugins.InsertForms.button,command:t,icon:e.config.CMSPluginUrl+"images/"+t+".png"};e.ui.addButton(t,r);e.addCommand(t,n)},pluginInsertMacro:function(e){var t="InsertMacro";var n="";if(e.config.ResolverName){n="resolver="+e.config.ResolverName}if(e.config.CurrentDocumentID){if(n){n+="&"}n+="documentid="+e.config.CurrentDocumentID}if(e.config.CurrentCulture){if(n){n+="&"}n+="culture="+e.config.CurrentCulture}var r={exec:function(e){CMSPlugin.currentEditor=e;var t=e.config.ApplicationPath+"CMSAdminControls/UI/Macros/Dialogs/Default.aspx?"+n;CMSPlugin.openModalDialog(t,"insertMacro",1024,660)}},i={label:e.lang.CMSPlugins.InsertMacro.button,command:t,icon:e.config.CMSPluginUrl+"images/"+t+".png"};e.ui.addButton(t,i);e.addCommand(t,r)},pluginInsertPolls:function(e){var t="InsertPolls",n={exec:function(e){var t="WidgetProperties.aspx?inline=true&isnew=1&widgetname=Poll";CMSPlugin.openWidget(e,t,"Poll","900","660")}},r={label:e.lang.CMSPlugins.InsertPolls.button,command:t,icon:e.config.CMSPluginUrl+"images/"+t+".png"};e.ui.addButton(t,r);e.addCommand(t,n)},pluginInsertGroupPolls:function(e){var t="InsertGroupPolls",n={exec:function(e){var t="WidgetProperties.aspx?inline=true&isnew=1&widgetname=GroupPoll";CMSPlugin.openWidget(e,t,"GroupPoll","900","660")}},r={label:e.lang.CMSPlugins.InsertGroupPolls.button,command:t,icon:e.config.CMSPluginUrl+"images/"+t+".png"};e.ui.addButton(t,r);e.addCommand(t,n)},pluginInsertRating:function(e){var t="InsertRating",n={exec:function(e){CMSPlugin.openWidget(e,"WidgetProperties.aspx?inline=true&isnew=1&widgetname=ContentRating_1","ContentRating_1","715","550")}},r={label:e.lang.CMSPlugins.InsertRating.button,command:t,icon:e.config.CMSPluginUrl+"images/"+t+".png"};e.ui.addButton(t,r);e.addCommand(t,n)},pluginKeyPress:function(e){var t=false,n=false,r=false;e.on("instanceReady",function(e){var i=function(e){return e.ctrlKey&&e.altKey},s=function(e){var i=e.data;i.key=i.getKey();i.ctrlKey=t;i.altKey=n;i.shiftKey=r;return i},o=function(e){var o,u=e.data.$.keyCode;if(u===17){t=true}else if(u===16){r=true}else if(u===18){n=true}else{o=s(e);if(!i(o)){a(o)}}},u=function(e){var o,u=e.data.$.keyCode;if(u===17){t=false}else if(u===16){r=false}else if(u===18){n=false}else{o=s(e);if(i(o)){a(o)}}},a=function(e){if(!window.disableShortcuts){if(window.HtmlEditor){return window.HtmlEditor.keyPressed(e)}else if(window.parent!==null&&window.parent.HtmlEditor){return window.parent.HtmlEditor.keyPressed(e)}}return true};e.editor.document.on("keydown",o);e.editor.document.on("keyup",u);e.editor.on("mode",function(e){var t=e.editor;if(t.mode!="source"){t.document.on("keydown",o);t.document.on("keyup",u)}})})},pluginInsertYouTube:function(e){var t="InsertYouTubeVideo",n={exec:function(e){CMSPlugin.currentEditor=e;var t;if(e.config.IsLiveSite){t=e.config.ApplicationPath+"CMSFormControls/LiveSelectors/InsertYouTubeVideo/Default.aspx"}else{t=e.config.ApplicationPath+"CMSFormControls/Selectors/InsertYouTubeVideo/Default.aspx"}CMSPlugin.openModalDialog(t,"youtube",1024,660)}},r={label:e.lang.CMSPlugins.InsertYouTubeVideo.button,command:t,icon:e.config.CMSPluginUrl+"images/"+t+".png"},i=function(e){var n=e.data.element;if(n.is("img")&&n.getAttribute("cms_youtube")=="true"){e.editor.execCommand(t)}},s={youtube:{label:e.lang.CMSPlugins.InsertYouTubeVideo.menu,command:t,group:t,icon:e.config.CMSPluginUrl+"images/"+t+".png"}};e.addCommand(t,n);e.ui.addButton(t,r);e.on("doubleclick",i);if(e.addMenuItems){e.addMenuGroup(t);e.addMenuItems(s)}if(e.contextMenu){e.contextMenu.addListener(function(e){if(e&&e.is("img")&&e.getAttribute("cms_youtube")=="true"){return{youtube:CKEDITOR.TRISTATE_OFF}}})}},pluginInsertWidget:function(e){var t="InsertWidget",n={exec:function(e){CMSPlugin.openWidget(e,"WidgetSelector.aspx?isnew=true&inline=true",null,"90%","85%")},open:function(e,t){t=t||CMSPlugin.currentEditor;var n;if(t.config.IsLiveSite){n=t.config.ApplicationPath+"CMSModules/Widgets/LiveDialogs/WidgetProperties.aspx?inline=true&isnew=1&widgetid="+e}else{n=t.config.ApplicationPath+"CMSModules/Widgets/Dialogs/WidgetProperties.aspx?inline=true&isnew=1&widgetid="+e}if(t.config.CurrentGroupID){n+="&groupid="+t.config.CurrentGroupID}CMSPlugin.openModalDialog(n,"widget",950,"95%")}},r={label:e.lang.CMSPlugins.InsertWidget.button,command:t,icon:e.config.CMSPluginUrl+"images/"+t+".png"},i=function(e){var n=e.data.element;if(n.is("img")&&n.getAttribute("cke_widget")=="true"){e.editor.execCommand(t)}},s={widget:{label:e.lang.CMSPlugins.InsertWidget.menu,command:t,group:t,icon:e.config.CMSPluginUrl+"images/"+t+".png"}};e.addCommand(t,n);e.ui.addButton(t,r);e.on("doubleclick",i);if(e.addMenuItems){e.addMenuGroup(t);e.addMenuItems(s)}if(e.contextMenu){e.contextMenu.addListener(function(e){if(e&&e.is("img")&&e.getAttribute("cke_widget")=="true"){return{widget:CKEDITOR.TRISTATE_OFF}}})}},pluginInsertImageOrMedia:function(e){var t="InsertImageOrMedia",n={exec:function(e){var t=window.unescape(e.config.MediaDialogWidth);var n=window.unescape(e.config.MediaDialogHeight);CMSPlugin.currentEditor=e;CMSPlugin.openModalDialog(e.config.MediaDialogURL,"imageormedia",t,n)}},r={label:e.lang.CMSPlugins.InsertImageOrMedia.button,command:t,icon:e.config.CMSPluginUrl+"images/"+t+".png"},i=function(e){var n=e.data.element;if(e.editor.config.removeButtons){for(var r in e.editor.config.removeButtons){if(e.editor.config.removeButtons[r]==="InsertImageOrMedia"){e.cancel();return}}}if(n.is("img")&&(n.getAttribute("cms_media")==="true"||!n.data("cke-realelement"))){e.editor.execCommand(t);e.cancel()}},s={imageormedia:{label:e.lang.CMSPlugins.InsertImageOrMedia.menu,command:t,group:t,icon:e.config.CMSPluginUrl+"images/"+t+".png"}};e.addCommand(t,n);e.ui.addButton(t,r);e.on("doubleclick",i,null,null,1);if(e.addMenuItems){e.addMenuGroup(t);e.addMenuItems(s)}if(e.contextMenu){e.contextMenu.addListener(function(e){if(e&&e.is("img")&&e.getAttribute("class")!="cke_anchor"&&e.data("cke-real-element-type")!="flash"&&(e.getAttribute("cms_media")=="true"||e.getAttribute("cms_disable_media")!="true")){return{imageormedia:CKEDITOR.TRISTATE_OFF}}})}},pluginInsertLink:function(e){var t="InsertLink",n={exec:function(e){var t=window.unescape(e.config.LinkDialogWidth);var n=window.unescape(e.config.LinkDialogHeight);CMSPlugin.currentEditor=e;CMSPlugin.openModalDialog(e.config.LinkDialogURL,"imageormedia",t,n)}},r={label:e.lang.CMSPlugins.InsertLink.button,command:t,icon:e.config.CMSPluginUrl+"images/"+t+".png"},i=function(n){var r;try{r=CKEDITOR.plugins.link.getSelectedLink(e)||n.data.element}catch(i){}if(n.editor.config.removeButtons){for(var s in n.editor.config.removeButtons){if(n.editor.config.removeButtons[s]==="InsertLink"){n.cancel();return}}}if(r){if(!r.isReadOnly()&&n.editor.config.toolbar!="Disabled"){if(r.is("a")){if(r.getAttribute("name")&&!r.getAttribute("href")){n.data.dialog="anchor"}else{n.editor.execCommand(t);n.cancel()}}else{if(r.is("img")&&r.data("cke-real-element-type")=="anchor"){n.data.dialog="anchor"}}}else{n.stop()}}},s={insertLink:{label:e.lang.CMSPlugins.InsertLink.menu,command:t,group:t,icon:e.config.CMSPluginUrl+"images/"+t+".png"}};e.addCommand(t,n,1);e.ui.addButton(t,r);e.on("doubleclick",i,null,null,1);if(e.addMenuItems){e.addMenuGroup(t);e.addMenuItems(s)}if(e.contextMenu){e.contextMenu.addListener(function(t){if(!t||t.isReadOnly())return null;var n=t.is("img")&&t.data("cke-real-element-type")=="anchor";if(!n){if(!(t=CKEDITOR.plugins.link.getSelectedLink(e)))return null;n=t.getAttribute("name")&&!t.getAttribute("href")}if(!n){return{insertLink:CKEDITOR.TRISTATE_OFF}}})}},pluginQuicklyInsertMedia:function(e){var t="QuicklyInsertImage",n={exec:function(e){CMSPlugin.currentEditor=e;CMSPlugin.saveFocus(e)}};e.addCommand(t,n);e.ui.addButton(t,{label:e.lang.CMSPlugins.QuicklyInsertImage.button,icon:e.config.CMSPluginUrl+"images/"+t+".png",onRender:function(){if(!e.config.qimId){e.config.qimId=[]}e.config.qimId.push(this._.id);e.on("instanceReady",function(){function n(e){if(e){var t=e.match(/(?:formGuid=)([a-z\d-]+)/i),n=e.match(/(?:documentid=)([\d]+)/i),r=e.match(/(?:parentid=)([\d]+)/i);if(t&&r&&/^[a-f\d]{8}-[a-f\d]{4}-[a-f\d]{4}-[a-f\d]{4}-[a-f\d]{12}$/i.test(t[1])&&parseInt(r[1],10)>=0){return true}if(n&&parseInt(n[1],10)>=0){return true}}return false}window.InsertImageOrMedia=function(e,t,n,r,i){CMSPlugin.insert(i)};for(u=0;u<e.config.qimId.length;u++){var r=e.config.qimId[u],i=document.getElementById(r);if(i!==null&&!i.QIM_set){i.QIM_set=true;if(n(this.config.QuickInsertURL)&&!window.disableQim){i.className+=" CMS_QIM";$cmsj(i).mouseenter(function(){CMSPlugin.currentEditor=e;CMSPlugin.saveFocus(e)});i.onmousemove=function(){CMSPlugin.currentEditor=e};var s=i.getElementsByTagName("span");var o;for(var u=0;u<s.length;u++){if(s[u].className.indexOf("cke_button_icon")>-1){o=s[u]}}if(typeof o!=="undefined"){o.style.position="relative";o.style.background="";var a=document.createElement("div");a.className="InnerDiv";a.style.position="absolute";a.style.top="0px";a.style.left="0px";a.style.display="inline-block";a.innerHTML='<img src="'+e.config.CMSPluginUrl+"images/"+t+'.png" style="width:16px; height:16px;" />';o.appendChild(a);var f=document.createElement("div");f.className="UploaderDiv";f.style.position="absolute";f.style.top="0px";f.style.width="16px";f.style.height="16px";f.style.visibility="visible";f.style.opacity="1";f.innerHTML='<iframe name="QuickInsertImage" src="'+e.config.QuickInsertURL+"&containerid="+r+'" frameborder="0" marginWidth="0" marginHeight="0" scrolling="no" border="0" style="width:16px; height:16px; overflow:hidden;" allowtransparency="true" ></iframe>';o.appendChild(f);var l=document.createElement("div");l.className="LoadingDiv";l.style.position="absolute";l.style.opacity="1";l.style.display="none";l.style.top="0px";l.style.left="0px";l.innerHTML='<img src="'+e.config.ApplicationPath+'CMSPages/GetResource.ashx?image=Design/Preloaders/preload16.gif" style="width:16px; height:16px;" />';o.appendChild(l);var c=document.createElement("script");c.type="text/javascript";c.src=e.config.ApplicationPath+"CMSModules/Content/Controls/Attachments/DirectFileUploader/DirectFileUploader.js";i.appendChild(c)}}else{i.parentNode.removeChild(i)}}}})}});e.on("mode",function(){if(e.config.qimId){for(var t=0;t<e.config.qimId.length;t++){var n=e.config.qimId[t],r=document.getElementById(n);if(r){var i=r.getElementsByTagName("iframe");if(e.mode=="source"){r.className+=" cke_button_disabled";if(i&&i.length===1){i[0].style.display="none"}}else{r.className=r.className.replace(/\s+cke_button_disabled/ig,"");if(i&&i.length===1){i[0].style.display=""}}}}}})},pluginInsertStrandsRecommender:function(e){var t="InsertStrandsRecommender",n={exec:function(e){CMSPlugin.currentEditor=e;var t=e.config.ApplicationPath+"CMSModules/StrandsRecommender/Pages/InsertEmailWidget.aspx";CMSPlugin.openModalDialog(t,"strandsRecommender",1e3,660)}},r={label:e.lang.CMSPlugins.InsertStrandsRecommender.button,command:t,icon:e.config.CMSPluginUrl+"images/"+t+".png"};e.ui.addButton(t,r);e.addCommand(t,n)},pluginForumButtons:function(e){var t="InsertQuote",n={exec:function(e){e.insertHtml("[quote=][/quote]")}},r={label:e.lang.CMSPlugins.InsertQuote.button,command:t,icon:e.config.CMSPluginUrl+"images/"+t+".png"},i="InsertImage",s={exec:function(e){var t=prompt(e.lang.CMSPlugins.InsertQuote.prompturl,"http://");if(t){e.insertHtml("[img]"+t+"[/img]")}}},o={label:e.lang.CMSPlugins.InsertImage.button,command:i,icon:e.config.CMSPluginUrl+"images/"+i+".png"},u="InsertUrl",a={exec:function(e){var t=prompt(e.lang.CMSPlugins.InsertUrl.prompturl,"http://");if(t){var n=prompt(e.lang.CMSPlugins.InsertUrl.promptdesc,"");e.insertHtml("[url="+t+"]"+n+"[/url]")}}},f={label:e.lang.CMSPlugins.InsertUrl.button,command:u,icon:e.config.CMSPluginUrl+"images/"+u+".png"};e.ui.addButton(t,r);e.addCommand(t,n);e.ui.addButton(i,o);e.addCommand(i,s);e.ui.addButton(u,f);e.addCommand(u,a)},initMaximalization:function(e){e.on("maximize",function(t){var n=t.data;if(e.config.sharedSpaces&&n==CKEDITOR.TRISTATE_ON){var r=new CKEDITOR.dom.element(document.body);var i=r.getCustomData("maximize_saved_styles").class;if(i.indexOf("cms-bootstrap")>-1){document.body.className+=" cms-bootstrap"}var s=$cmsj("#"+e.config.sharedSpaces.top);var o=s.offset().top+s.outerHeight();var u=e.container.getChild(1);u.setStyle("top",o+"px");var a=CKEDITOR.document.getWindow().getViewPaneSize();var f=$cmsj("#"+e.config.sharedSpaces.bottom);var l=a.height-o-f.outerHeight();e.resize(a.width,l,null,true)}})},initPopupOpener:function(e){e.popup=function(e,t,n,r){CMSPlugin.openModalDialog(e,"CKEditorPopup",t,n,r)}},initContextMenu:function(e){var t={Image:"image",Link:"link",Unlink:"unlink",Flash:"flash",Table:"table"},n=e.config.toolbar instanceof Array?e.config.toolbar:e.config["toolbar_"+e.config.toolbar];if(typeof n!=="undefined"){for(var r=0;r<n.length;r++){var i=n[r];if(!i){continue}for(var s=0;s<i.length;s++){var o=i[s];if(t[o]){delete t[o]}}}for(var u in t){delete e._.menuItems[t[u]]}}},initSelection:function(e){e.on("beforeCommandExec",function(e){CMSPlugin.saveFocus(e.editor)})},initDataProcesor:function(e){var t=e.dataProcessor,n=t&&t.dataFilter;if(n){n.addRules({elements:{"cke:object":function(t){if(t.attributes.codetype&&t.attributes.codetype.toLowerCase()=="cmsinlinecontrol"){return CMSPlugin.createFakeControl(t,e)}else{var n=t.attributes,r=n.classid&&String(n.classid).toLowerCase();if(!r&&!CMSPlugin.isFlashEmbed(t)){for(var i=0;i<t.children.length;i++){if(t.children[i].name=="cke:embed"){if(!CMSPlugin.isFlashEmbed(t.children[i])){return null}t.attributes.type="flash";return CMSPlugin.createFakeControl(t,e)}}return null}t.attributes.type="flash";return CMSPlugin.createFakeControl(t,e)}},"cke:embed":function(t){var n=null;if(CMSPlugin.isFlashEmbed(t)){t.attributes.type="flash";n=CMSPlugin.createFakeControl(t,e)}return n}}},3)}},getInline:function(e,t){var n={};if(e){var r=e.getAttribute("type"),i=e.getAttribute("width"),s=e.getAttribute("height");if(r){if(r.toLowerCase()=="media"){r=this.getMediaType(e)}n["cms_type"]=r}if(e.childNodes){var o=this.getPropertyPrefix(r);if(i){n[o+"width"]=i}if(s){n[o+"height"]=s}var u=e.childNodes.length;for(var a=0;a<u;a++){var f=e.childNodes[a];var l=f.getAttribute("name");var c=f.getAttribute("value");if(l){n[o+l]=c;if(o+l==="flash_movie"){n["flash_url"]=c}}}}try{e=CKEDITOR.dom.element.get(t);if(e){var h=e.getAscendant("a",true);if(h){n[o+"link"]=h.getAttribute("data-cke-saved-href")||h.getAttribute("href");n[o+"target"]=h.getAttribute("target")}}}catch(p){}}return n},getPropertyPrefix:function(e){var t="";switch(e.toLowerCase()){case"youtubevideo":t="youtube_";break;case"image":t="img_";break;case"audiovideo":t="av_";break;case"flash":t="flash_";break}return t},getInlineType:function(e){var t="";switch(e.toLowerCase()){case"youtubevideo":t="YouTubeVideo";break;case"image":t="Image";break;case"audiovideo":case"flash":t="Media";break;case"widget":t="Widget";break}return t},createCKElement:function(e){var t=this.getCurrentEditor();if(t){return t.document.createElement(e)}return null},insertInline:function(e,t){if(e){var n=this.getInlineType(e),r=this.getPropertyPrefix(e),i=this.getCurrentEditor(),s='<object style="display: none" codetype="CMSInlineControl" type="'+n+'" ',o={img_link:1,img_target:1},u={img_hspace:-1,img_vspace:-1,img_borderwidth:-1,flash_loop:"False",flash_autoplay:"False",flash_menu:"False",av_autoplay:"False",av_loop:"False",av_controls:"True"};if(t[r+"width"]){s+='width="'+t[r+"width"]+'" ';t[r+"width"]=null}if(t[r+"height"]){s+='height="'+t[r+"height"]+'" ';t[r+"height"]=null}s+=">";for(var a in t){if(!o[a]&&t[a]&&t[a]!=u[a]){s+='<param name="'+a.replace(r,"")+'" value="'+t[a]+'" />'}}s+="</object>";if(t["img_link"]){var f;try{CMSPlugin.restoreFocus(i);var l=i.getSelection();if(l.getType()==CKEDITOR.SELECTION_ELEMENT){var c=l.getSelectedElement();if(c.is("a")){f=c}}var h=l.getRanges(true)[0];h.shrink(CKEDITOR.SHRINK_TEXT);var p=h.getCommonAncestor();f=p.getAscendant("a",true)}catch(d){}if(!f){var v='<a href="'+t["img_link"]+'" ';if(t["img_target"]){v+='target="'+t["img_target"]+'" '}v+=">";s=v+s+"</a>"}else{var m={href:"javascript:void(0)/*"+CKEDITOR.tools.getNextNumber()+"*/"},g=[];m["data-cke-saved-href"]=t["img_link"];if(t["img_target"]){m["target"]=t["img_target"]}else{g.push("target")}f.setAttributes(m);f.removeAttributes(g);f.setHtml(s);s=f.getOuterHtml()}}else{i.document.$.execCommand("unlink",false,null)}this.insertHtml(s)}},insertLink:function(e){var t={href:"javascript:void(0)/*"+CKEDITOR.tools.getNextNumber()+"*/"},n=[],r=this.getCurrentEditor(),i=null,s=null,o=null,u=null;try{CMSPlugin.restoreFocus(r);b=r.getSelection();if(b.getType()==CKEDITOR.SELECTION_ELEMENT){var a=b.getSelectedElement();if(a.is("a")){i=a}}E=b.getRanges(true)[0];E.shrink(CKEDITOR.SHRINK_TEXT);var f=E.getCommonAncestor();i=f.getAscendant("a",true)}catch(l){}if(e.link_url){var c=e.link_protocol||"",h=e.link_url||"";t["data-cke-saved-href"]=h.indexOf("/")===0?h:c+h}else if(e.anchor_name){s=e.anchor_name||"",o=e.anchor_custom||"",u=e.anchor_id||"";t["data-cke-saved-href"]="#"+(s||o||u||"")}else if(e.email_to){var p=e.email_cc,d=e.email_bcc,v=e.email_subject,m=e.email_body,g=[];if(p){g.push("cc="+p)}if(d){g.push("bcc="+d)}if(v){g.push("subject="+v)}if(m){g.push("body="+m)}g=g.length?"?"+g.join("&"):"";t["data-cke-saved-href"]="mailto:"+e.email_to+g}if(e.link_target){t.target=e.link_target}else{n.push("target")}if(e.link_url){var y=function(e,r,i){var s=e[r];if(s){t[i]=s}else{n.push(i)}};y(e,"link_url","href");y(e,"link_id","id");y(e,"link_target","target");y(e,"link_class","class");y(e,"link_tooltip","title");y(e,"link_style","style");if(e.link_name){t["name"]=t["data-cke-saved-name"]=e.link_name;t["class"]=(t["class"]?t["class"]+" ":"")+"cke_anchor"}else{n=n.concat(["data-cke-saved-name","name"])}}if(!i){var b=r.getSelection(),w=b.getRanges(true),E=w[0],S,x;if(w.length==1&&E.collapsed){S=new CKEDITOR.dom.text(e.email_linktext?e.email_linktext:e.email_to?e.email_to:e.anchor_linktext?e.anchor_linktext:e.anchor_name?e.anchor_name:e.link_text?e.link_text:e.link_url,r.document);w[0].insertNode(S);w[0].selectNodeContents(S);b.selectRanges(w)}x=new CKEDITOR.style({element:"a",attributes:t});x.type=CKEDITOR.STYLE_INLINE;x.applyToRange(E);if(e.link_id){var T=r.document.$.getElementsByTagName("a");for(var N=0;N<T.length;N++){if(T[N].getAttribute("href")==t.href){T[N].id=e.link_id;break}}}}else{var C=i;C.setAttributes(t);C.removeAttributes(n);if(C.getAttribute("name")){C.addClass("cke_anchor")}else{C.removeClass("cke_anchor")}if(this.fakeObj){r.createFakeElement(C,"cke_anchor","anchor").replace(this.fakeObj)}delete i}},insertImage:function(e){var t=this.createCKElement("img");if(t!=null){if(e.img_id){t.$.id=e.img_id}if(e.img_url){t.$.src=e.img_url;t.$.setAttribute("data-cke-saved-src",e.img_url)}if(e.img_alt){t.$.alt=e.img_alt}else{if(e.img_tooltip){t.$.alt=e.img_tooltip}else{t.$.alt=""}}if(e.img_tooltip){t.$.title=e.img_tooltip}if(e.img_class){t.$.setAttribute("class",e.img_class)}if(e.img_dir){t.$.dir=e.img_dir}if(e.img_usemap){t.$.useMap=e.img_usemap}if(e.img_longdescription){t.$.setAttribute("longdesc",e.img_longdescription)}if(e.img_lang){t.$.lang=e.img_lang}if(e.img_style){t.setAttribute("style",e.img_style);if(t.$.style.cssStyle!=undefined){t.$.style.cssStyle=e.img_style}if(t.$.style.cssText!=undefined){t.$.style.cssText=e.img_style}}if(e.img_width&&parseInt(e.img_width,10)>=0){t.$.style.width=parseInt(e.img_width,10)+"px"}if(e.img_height&&parseInt(e.img_height,10)>=0){t.$.style.height=parseInt(e.img_height,10)+"px"}if(e.img_borderwidth&&parseInt(e.img_borderwidth,10)>=0){t.$.style.borderWidth=e.img_borderwidth+"px";t.$.style.borderStyle="solid"}if(e.img_bordercolor){try{t.$.style.borderColor=e.img_bordercolor}catch(n){t.$.style.borderColor=""}}if(e.img_align){if(e.img_align=="left"||e.img_align=="right"){if(t.$.style.cssFloat!=undefined){t.$.style.cssFloat=e.img_align}if(t.$.style.styleFloat!=undefined){t.$.style.styleFloat=e.img_align}}else{if(t.$.style.verticalAlign!=undefined){t.$.style.verticalAlign=e.img_align}if(t.$.style["vartical-align"]!=undefined){t.$.style["vartical-align"]=e.img_align}}}if(e.img_vspace||e.img_hspace){var r=parseInt(e.img_vspace,10),i=parseInt(e.img_hspace,10);if(r==i&&r>=0){t.$.style.margin=i+"px"}else{if(r==i&&r==-1){}else{t.$.style.margin=(r>=0?r+"px ":"auto ")+(i>=0?i+"px":"auto")}}}if(e.img_link||e.img_behavior){var s=this.createCKElement("a");if(e.img_link){s.$.href=e.img_link;s.$.setAttribute("data-cke-saved-href",e.img_link)}if(e.img_target){s.$.setAttribute("target",e.img_target)}else if(e.img_behavior){s.$.setAttribute("target",e.img_behavior)}s.append(t);this.insertElement(s)}else{this.insertElement(t)}}},insertHtml:function(e){var t=this.getCurrentEditor();if(t){CMSPlugin.restoreFocus(t);t.insertHtml(e)}},insertElement:function(e){var t=this.getCurrentEditor();if(t){CMSPlugin.restoreFocus(t);t.insertElement(e)}},insert:function(e){if(e){var t=e.cms_type;if(t){this.insertInline(t,e)}else{if(e.link_url||e.email_to||e.anchor_name){this.insertLink(e)}else{if(e.img_url){this.insertImage(e)}}}}},saveFocus:function(e){CMSPlugin.selection=e.getSelection();if(CMSPlugin.selection){CMSPlugin.selectedElement=CMSPlugin.selection.getSelectedElement();CMSPlugin.selectionBookmarks=CMSPlugin.selection.createBookmarks2()}else{CMSPlugin.selectedElement=null;CMSPlugin.selectionBookmarks=null}},restoreFocus:function(e){if(CMSPlugin.selection){if(CMSPlugin.selectionBookmarks){CMSPlugin.selection.selectBookmarks(CMSPlugin.selectionBookmarks)}else if(CMSPlugin.selectedElement){CMSPlugin.selection.selectElement(CMSPlugin.selectedElement)}else{e.focus()}}else{e.focus()}},openModalDialog:function(e,t,n,r,i){window.modalDialog(e,t,n,r,i)},beforeInit:function(e){this.pluginKeyPress(e)},init:function(e){this.initCss(e);this.initMaximalization(e);this.initSelection(e);this.pluginInsertForms(e);this.pluginInsertMacro(e);this.pluginInsertPolls(e);this.pluginInsertGroupPolls(e);this.pluginInsertRating(e);this.pluginInsertYouTube(e);this.pluginInsertWidget(e);this.pluginInsertImageOrMedia(e);this.pluginInsertLink(e);this.pluginQuicklyInsertMedia(e);this.pluginInsertStrandsRecommender(e);this.pluginForumButtons(e)},afterInit:function(e){this.initContextMenu(e);this.initDataProcesor(e);this.initPopupOpener(e)}};CKEDITOR.plugins.add("CMSPlugins",CMSPlugin)